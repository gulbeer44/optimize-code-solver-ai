<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Optimize Code Solver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg: #0d0f11;
      --bg-alt: #1a1d21;
      --border: #333;
      --accent: #16A9FF;
      --accent-soft: #0c87c7;
      --accent-green: #4DFF4D;
      --text: #ffffff;
      --code: #00ff99;
    }

    body.light {
      --bg: #f5f5f7;
      --bg-alt: #ffffff;
      --border: #cccccc;
      --accent: #0066cc;
      --accent-soft: #004c99;
      --accent-green: #00994d;
      --text: #111111;
      --code: #008f5a;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, Arial, sans-serif;
    }

    .app {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px 16px 40px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .logo-area {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-circle {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 30%, #4DFF4D, #16A9FF);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: monospace;
      font-weight: 700;
      font-size: 20px;
      color: #0d0f11;
    }

    .title-block h1 {
      margin: 0;
      font-size: 24px;
    }

    .subtitle {
      margin-top: 4px;
      font-size: 13px;
      opacity: 0.8;
      border-right: 2px solid var(--accent);
      width: 0;
      white-space: nowrap;
      overflow: hidden;
      animation: typing 3s steps(40, end) forwards, blinkCursor 0.7s infinite;
    }

    @keyframes typing { from { width: 0; } to { width: 330px; } }
    @keyframes blinkCursor {
      0%, 49% { border-color: var(--accent); }
      50%,100% { border-color: transparent; }
    }

    .theme-toggle {
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--bg-alt);
      border: 1px solid var(--border);
      cursor: pointer;
      font-size: 12px;
    }

    .main {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    @media (max-width: 900px) {
      .main { grid-template-columns: 1fr; }
    }

    .panel {
      background: var(--bg-alt);
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 14px;
      min-height: 280px;
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 12px;
    }

    .chip {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 11px;
    }

    .chip.green { color: var(--accent-green); border-color: var(--accent-green); }

    textarea {
      flex: 1;
      width: 100%;
      background: #101317;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px;
      color: var(--code);
      font-family: monospace;
      resize: vertical;
    }

    body.light textarea {
      background: #f3f3f7;
      color: #1b4d2f;
    }

    button {
      padding: 8px 14px;
      background: var(--accent);
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
    }

    button.secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
    }

    .output-content {
      flex: 1;
      background: #101317;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px;
      overflow-y: auto;
      font-family: monospace;
    }

  </style>
</head>

<body>
  <div class="app">

    <!-- HEADER -->
    <header>
      <div class="logo-area">
        <div class="logo-circle">{ }</div>
        <div class="title-block">
          <h1>Optimize <span class="accent">Code Solver</span></h1>
          <div class="subtitle">AI that cleans, fixes & explains your code.</div>
        </div>
      </div>

      <button class="theme-toggle" onclick="toggleTheme()">
        üåô <span id="themeLabel">Dark mode</span>
      </button>
    </header>

    <!-- CONTENT -->
    <main class="main">

      <!-- LEFT: INPUT -->
      <section class="panel">
        <div class="panel-header">
          <span class="label">Input Code</span>
          <span class="chip">Paste any language</span>
        </div>

        <textarea id="inputCode" placeholder="Paste your code here..."></textarea>

        <div class="btn-row">
          <button onclick="optimizeCode()">‚ö° Optimize</button>
          <button class="secondary" onclick="clearInput()">üßπ Clear</button>
        </div>
      </section>

      <!-- RIGHT: OUTPUT -->
      <section class="panel">
        <div class="panel-header">
          <span class="label">AI Output</span>
          <span class="chip green">Optimized + Explained</span>
        </div>

        <div id="result" class="output-content">
          <span style="opacity:0.7;">Your optimized code & explanation will appear here...</span>
        </div>

        <div class="btn-row">
          <button class="secondary" onclick="downloadResult()">‚¨áÔ∏è Download Result</button>
        </div>
      </section>

    </main>

    <div class="footer-note">
      Built by <b>Gulbeer Singh</b> ‚Ä¢ Your personal AI code optimizer.
    </div>
  </div>

  <!-- FIXED SCRIPT -->
<script>
  async function optimizeCode() {
    const code = document.getElementById("inputCode").value;
    const result = document.getElementById("result");

    if (!code.trim()) {
      result.innerHTML = "<span style='color:red;'>Please paste your code first.</span>";
      return;
    }

    result.innerHTML = "<div class='loading'>‚è≥ Optimizing your code...</div>";

    try {
      const response = await fetch("/api/optimize", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          message: `Optimize this code:\n${code}`
        })
      });

      const data = await response.json();

      if (data.error) {
        result.innerHTML = "<span style='color:red;'>‚ùå " + data.error + "</span>";
        return;
      }

      if (data.response) {
        result.innerHTML = data.response.replace(/\n/g, "<br>");
      } else {
        result.innerHTML = "‚ö† No response from agent.";
      }
    } catch (error) {
      result.innerHTML = "<span style='color:red;'>‚ùå Error: " + error + "</span>";
    }
  }

  function clearInput() {
    document.getElementById("inputCode").value = "";
    document.getElementById("result").innerHTML =
      "<span style='opacity:0.7;'>Your optimized code & explanation will appear here...</span>";
  }
</script>
</body>
</html>
